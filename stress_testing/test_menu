#!/usr/bin/env python3
"""
Menu interativo para executar diferentes tipos de teste no GestokPro
"""

import asyncio
import os
import sys

def show_menu():
    print("\nğŸ§ª GestokPro - Menu de Testes de Performance")
    print("=" * 50)
    print("1. Teste RÃ¡pido (30s) - 2 usuÃ¡rios por onda")
    print("2. Teste Completo (60s) - 3 usuÃ¡rios por onda") 
    print("3. Teste AvanÃ§ado (45s) - Carga mista com relatÃ³rio detalhado")
    print("4. Teste Intenso (90s) - 5 usuÃ¡rios por onda")
    print("5. Ver Ãºltimo relatÃ³rio gerado")
    print("0. Sair")
    print("-" * 50)

async def run_basic_test(duration, users):
    """Executa teste bÃ¡sico"""
    from test_stress import GestokProStressTester
    
    tester = GestokProStressTester(base_url="http://localhost:5000")
    await tester.run_stress_test(duration_seconds=duration, users_per_wave=users)
    return tester.generate_performance_report()

async def run_advanced_test():
    """Executa teste avanÃ§ado"""
    from advanced_stress_test import AdvancedGestokProTester
    
    tester = AdvancedGestokProTester(base_url="http://localhost:5000")
    await tester.run_mixed_load_test(duration_seconds=45)
    return tester.generate_advanced_report()

def show_latest_report():
    """Mostra o Ãºltimo relatÃ³rio gerado"""
    import glob
    
    # Busca pelos relatÃ³rios mais recentes
    basic_reports = glob.glob("stress_test_report_*.md")
    advanced_reports = glob.glob("advanced_stress_report_*.md")
    
    all_reports = basic_reports + advanced_reports
    
    if not all_reports:
        print("âŒ Nenhum relatÃ³rio encontrado")
        return
    
    # Ordena por data de modificaÃ§Ã£o
    all_reports.sort(key=os.path.getmtime, reverse=True)
    latest_report = all_reports[0]
    
    print(f"\nğŸ“„ Ãšltimo relatÃ³rio: {latest_report}")
    print("-" * 50)
    
    try:
        with open(latest_report, 'r', encoding='utf-8') as f:
            content = f.read()
            # Mostra apenas o resumo (primeiras 50 linhas)
            lines = content.split('\n')[:50]
            print('\n'.join(lines))
            
            if len(content.split('\n')) > 50:
                print("\n... (relatÃ³rio completo no arquivo)")
                
    except Exception as e:
        print(f"âŒ Erro ao ler relatÃ³rio: {e}")

async def main():
    """Menu principal"""
    while True:
        show_menu()
        
        try:
            choice = input("Escolha uma opÃ§Ã£o: ").strip()
            
            if choice == "0":
                print("ğŸ‘‹ AtÃ© logo!")
                break
                
            elif choice == "1":
                print("ğŸš€ Iniciando teste rÃ¡pido...")
                report = await run_basic_test(duration=30, users=2)
                print(f"âœ… Teste concluÃ­do! RelatÃ³rio: {report}")
                
            elif choice == "2":
                print("ğŸš€ Iniciando teste completo...")
                report = await run_basic_test(duration=60, users=3)
                print(f"âœ… Teste concluÃ­do! RelatÃ³rio: {report}")
                
            elif choice == "3":
                print("ğŸš€ Iniciando teste avanÃ§ado com carga mista...")
                report = await run_advanced_test()
                print(f"âœ… Teste avanÃ§ado concluÃ­do! RelatÃ³rio: {report}")
                
            elif choice == "4":
                print("ğŸš€ Iniciando teste intenso...")
                report = await run_basic_test(duration=90, users=5)
                print(f"âœ… Teste intenso concluÃ­do! RelatÃ³rio: {report}")
                
            elif choice == "5":
                show_latest_report()
                
            else:
                print("âŒ OpÃ§Ã£o invÃ¡lida!")
                
            input("\nPressione Enter para continuar...")
            
        except KeyboardInterrupt:
            print("\nğŸ‘‹ Teste interrompido pelo usuÃ¡rio!")
            break
        except Exception as e:
            print(f"âŒ Erro: {e}")

if __name__ == "__main__":
    asyncio.run(main())
